<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>2024-10-27-telegram自动批量译文追加在原文下方以及appleid注册验证码自动识别 - 记录伟大征程</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">




<meta name="description" content="">





    <meta name="description" content="telegram有插件月费40可以实时翻译任何语言，我粗看了下大概是发送到火山翻译然后把译文用js附加html元素显示在原文下，目前一天下来总会花不少时间刷知乎、rt今日俄罗斯看看有没有什么刺激的新闻，消息有限是一方面另外长期如此也容易信息茧房，于是想在telegram看看有什么关注度大的频道利用chatgpt来逆向这个telegram的翻译插件。这个程序用到了beautiful soup格式化h">
<meta property="og:type" content="article">
<meta property="og:title" content="2024-10-27-telegram自动批量译文追加在原文下方以及appleid注册验证码自动识别">
<meta property="og:url" content="http://zhudian.xyz/2024/11/03/2024-10-27/index.html">
<meta property="og:site_name" content="记录伟大征程">
<meta property="og:description" content="telegram有插件月费40可以实时翻译任何语言，我粗看了下大概是发送到火山翻译然后把译文用js附加html元素显示在原文下，目前一天下来总会花不少时间刷知乎、rt今日俄罗斯看看有没有什么刺激的新闻，消息有限是一方面另外长期如此也容易信息茧房，于是想在telegram看看有什么关注度大的频道利用chatgpt来逆向这个telegram的翻译插件。这个程序用到了beautiful soup格式化h">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://zhudian.xyz/2024/11/03/2024-10-27/2024-10-27/1da5e011ff95df40955d66fe46794920_MD5.jpg">
<meta property="og:image" content="http://zhudian.xyz/2024/11/03/2024-10-27/2024-10-27/364d22cb896eec439a4a1c4b288c9788_MD5.jpg">
<meta property="og:image" content="http://zhudian.xyz/2024/11/03/2024-10-27/2024-10-27/4c71d780dfc4d85f0c7d857933d28bfd_MD5.jpg">
<meta property="og:image" content="http://zhudian.xyz/2024/11/03/2024-10-27/2024-10-27/ab79177bc2b1f0a09a6cdbddad012b53_MD5.jpg">
<meta property="og:image" content="http://zhudian.xyz/2024/11/03/2024-10-27/2024-10-27/2344457ba021872794f98313daf25eca_MD5.jpg">
<meta property="article:published_time" content="2024-11-03T08:39:24.000Z">
<meta property="article:modified_time" content="2024-11-03T09:36:13.835Z">
<meta property="article:author" content="于洋">
<meta property="article:tag" content="telegram">
<meta property="article:tag" content="媒体新闻">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://zhudian.xyz/2024/11/03/2024-10-27/2024-10-27/1da5e011ff95df40955d66fe46794920_MD5.jpg">





<link rel="icon" href="/favicon.ico">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">


<link rel="stylesheet" href="/css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    
    
    
    
    

    


<meta name="generator" content="Hexo 6.0.0"></head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    <img src="/long3.jpg" alt="" height="28">
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">归档</a>
            
            <a class="navbar-item "
               href="/categories/%E5%BB%BA%E7%AD%91%E7%90%86%E8%AE%BA">建筑理论</a>
            
            <a class="navbar-item "
               href="/categories/CG%E6%8A%80%E6%9C%AF">CG技术</a>
            
            <a class="navbar-item "
               href="/categories/%E6%97%A5%E8%AE%B0">日记</a>
            
            <a class="navbar-item "
               href="/about">我的目标</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="搜索" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="目录">
                    <i class="fa fa-list"></i>
                </a>
                <div class="navbar-dropdown is-right">
                    
                    
                </div>
            </div>
            
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            2024-10-27-telegram自动批量译文追加在原文下方以及appleid注册验证码自动识别
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2024-11-03T08:39:24.000Z" itemprop="datePublished">11月 3 2024</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/%E6%97%A5%E8%AE%B0/">日记</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            37 分钟 读完 (约 5554 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <html><head></head><body><p>telegram有插件月费40可以实时翻译任何语言，我粗看了下大概是发送到火山翻译然后把译文用js附加html元素显示在原文下，目前一天下来总会花不少时间刷知乎、rt今日俄罗斯看看有没有什么刺激的新闻，消息有限是一方面另外长期如此也容易信息茧房，于是想在telegram看看有什么关注度大的频道利用chatgpt来逆向这个telegram的翻译插件。这个程序用到了beautiful soup格式化html提取文本，分段发送给火山翻译。需要注意的有几点：</p>
<p>1.translate_tab = tab.get_tab(url=’<a target="_blank" rel="noopener" href="http://volcengine.com/">volcengine.com</a>‘) 用get_tab可以获取当前已有的标签页，我一开始是打开telegram再跳转到火山翻译，反复横跳。这样会造成每次跳转需要设置页面加载等待时间，另外火山翻译每次打开默认是翻译为英文，如果页面始终保持打开不刷新的话，可以设置好中文，这样不用反复切换翻译语言，那样也会耗时。</p>
<p>2.有时会莫名其妙翻译语言切换为英文，这里检测翻译语言，若因为不明原因发生变动则使其切换为中文。</p>
<p>3.过滤掉一些出现文本的html元素以及某些文本，比如点赞数的数字，日期，http www链接等等，@用户名，这些都会浪费时间没有翻译的意义。</p>
<p>4.一开始翻译遇到了译文顺序问题，多段译文会倒叙排列，因为后翻译的会去紧贴原文的div，我想了下不如把同一个div中的原文合并提交，这样还可以节约提交次数省事且解决了顺序问题，因为同一个div下的原文会合并一次性翻译出来。这样做还能避免重复出现过的内容检测第1个div从而使译文错位的问题。</p>
<p>5.译文因为重复出现过的内容检测第1个div从而使译文错位的问题，可以通过添加属性给属性值translated作为标记从而跳过，这个手法或许在4的使用下变得没有用武之地，不过其他项目可以参考。</p>
<p><img src="/2024/11/03/2024-10-27/2024-10-27/1da5e011ff95df40955d66fe46794920_MD5.jpg"></p>
<span id="more"></span>

<p>目前实测下来40多条消息大约20分钟出头可以翻译完。抽空多找几个热门的多语种频道，测试一下。目前俄罗斯的频道找了5个，印度1个，中东的3个，巴西的2个，阿根廷的2个。以后可以尝试在zhudian.xyz开个栏目，每天自动汇总各国的新闻翻译版？</p>
<p>2024-11-1更新：</p>
<p>试了下，思路是通过blob链接用js解析base64下载图片，不过不知道为什么容易丢失，目前不知道原因即使检测本地文件夹是否存在文件也查不出来，明明没有却没print出来异样有待进一步研究。考虑到所有的div都是一次加载图片、视频容易刷不出来，这里加入js lazy加载图片视频，先把src改为data-src随着看到图片时再切回来，所以图片和视频的soup html里面要对class为full-media的加入lazy并把src删除。视频则是通过xpath定位到位置以后右键下载的，似乎视频的丢失概率比较小，我原本想用下载视频的方式处理图片，不过出错了，由于一个div下包含多个图片（不过也有一个div包含多个视频的貌似没出问题），导致用这种方法会重复下载第1个图，我按照enumerate索引div下每个图片，但是运行出错。</p>
<p>用chrome的css插件，拼凑了1个css，成功把telegram的消息框、图片、视频、奇怪的各种符号排版到位。soup用decompose去掉了评论、点赞那些东西为了不让翻译变得麻烦，再输出html时同样利用这个把不必要的那些都扔了。</p>
<p>hexo上传方面每次记得hexo clean清除缓存，不然的话html和css都会出问题，正常来说hexo d成功后，大约5分钟后就可以看到远程zhudian.xyz上的页面效果。由于在线的视频压缩都要钱（我不明白它是如何在我删除历史记录且不登录的情况下还能判断我的试用到期），还是用moo0来压缩，写了两个双击就能执行的程序，先把大于25mb的视频转移到指定目录，然后moo0打开默认目录就是它全选压缩设定为25mb也是默认的，压缩完毕后双击程序自动重命名并移动回telegram的hexo目录下。</p>
<p>hexo d顶多2分钟部署超时卡着不动么，就ctrl c终止再来一遍。</p>
<p><img src="/2024/11/03/2024-10-27/2024-10-27/364d22cb896eec439a4a1c4b288c9788_MD5.jpg"></p>
<p><img src="/2024/11/03/2024-10-27/2024-10-27/4c71d780dfc4d85f0c7d857933d28bfd_MD5.jpg"></p>
<p>晚上试了一下在hexo的source下新开文件夹作为目录存放telegram页面，手动黏贴了几个消息，用chrome插件解析css手动修改了一些css，本地测试效果如下。hexo 渲染页面要在config里面用skip render跳过这个文件夹，之后hexo clean不然skip render不起作用。</p>
<p><img src="/2024/11/03/2024-10-27/2024-10-27/ab79177bc2b1f0a09a6cdbddad012b53_MD5.jpg"></p>
<p>2024-11-3更新：</p>
<p>我把img class 包含full-media的和不包含full-media的分两种下载方式前者用右键后者则是base64，另外full-media还有一种情况是多图，在这种情况下也采用base64。telegram里面右键full-media多图下载会一次性下载全部且无法对每个重命名，这种情况下只有base64下载可以解决重命名问题。在昨天的图片下载测试中全部显示了，几乎没有丢失。</p>
<p>视频下载的问题在于要把目标div逐个滚动条定位一遍使得video标签加载到soup解析的html，然后再下载。下载的视频有时候是MP4扩展名，再用程序批量修改为小写mp4。不知道为什么我在测试中发生了视频文件名相同的情况导致报错退出，修改了程序避免文件名冲突而退出。另外video要添加muted属性，不然网页中无法启动自动播放。</p>
<p>moo0压缩时要选x264那个选项不然网页上会因为编码原因显示不了。目前测试下来25x6=150个消息约需要1.5小时完成图片、视频下载和翻译。这样的话通宵开着1.5x4大约一晚上搞个600条消息不成问题也就是24个频道收集各种消息。</p>
<p><img src="/2024/11/03/2024-10-27/2024-10-27/2344457ba021872794f98313daf25eca_MD5.jpg"></p>
<p>suno那边discord和google账号都需要手机号验证了，没法注册了，而且discord的注册需要完成比较复杂的验证。我今天搜了一下发现了ddddocr这个项目通过ai来识别验证码，目前appleid这边可以反复用中国手机注册账号，只不过有个图片包含字母数字的验证码，我测试了ddddocr可以成功识别appleid注册时的验证码，这样的话批量注册appleid应该就不是问题了。suno作曲每天appleid和microsoft两个账号轮流就行了。appleid批量注册么还需要一个手机验证码自动发送到电脑的程序，这周抽空搞一下。</p>
<p>2024-11-1更新：</p>
<p>暂时不用折腾了，我发现在suno create error后可以对歌曲做extend操作，而extend之后就不再有那个error的问题了。又可以恢复到大量作曲的时光了。我甚至发现多个chrome账号都可以用，退出后自选即可，这样的话appleid这边就可以不用多考虑了。理论上我可以4个chrome号方便切换加1个discord和1个微软，1天6个号作曲。</p>
<figure class="highlight python hljs"><figcaption><span>批量自动翻译指定频道指定消息数下载相应图片视频并排版输出html</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">from</span> DrissionPage <span class="hljs-keyword">import</span> ChromiumPage, ChromiumOptions</span><br><span class="line"><span class="hljs-keyword">from</span> DrissionPage.common <span class="hljs-keyword">import</span> By</span><br><span class="line"><span class="hljs-keyword">import</span> time</span><br><span class="line"><span class="hljs-keyword">import</span> re</span><br><span class="line"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="hljs-keyword">import</span> os</span><br><span class="line"><span class="hljs-keyword">import</span> requests</span><br><span class="line"><span class="hljs-keyword">import</span> json</span><br><span class="line"><span class="hljs-keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 设置Chromium选项</span></span><br><span class="line">do1 = ChromiumOptions().set_paths(local_port=<span class="hljs-number">9111</span>, user_data_path=<span class="hljs-string">r'C:/Users/A/AppData/Local/Google/Chrome/User Data'</span>)</span><br><span class="line">tab = ChromiumPage(addr_or_opts=do1)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">download_images</span>(<span class="hljs-params">top_limit_message_divs, download_folder, max_retries=<span class="hljs-number">6</span></span>):</span><br><span class="line">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(download_folder):</span><br><span class="line">        os.makedirs(download_folder)  <span class="hljs-comment"># 创建下载目录</span></span><br><span class="line"></span><br><span class="line">    total_blob_images = <span class="hljs-number">0</span>  <span class="hljs-comment"># 统计所有 blob 图片总数</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">for</span> div <span class="hljs-keyword">in</span> top_limit_message_divs:</span><br><span class="line">        <span class="hljs-comment"># 找到所有 img 标签</span></span><br><span class="line">        img_tags = div.find_all(<span class="hljs-string">'img'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 替换 ./ 为完整路径</span></span><br><span class="line">        <span class="hljs-keyword">for</span> img <span class="hljs-keyword">in</span> img_tags:</span><br><span class="line">            img_url = img.get(<span class="hljs-string">'src'</span>)</span><br><span class="line">            <span class="hljs-keyword">if</span> img_url <span class="hljs-keyword">and</span> img_url.startswith(<span class="hljs-string">'./'</span>):</span><br><span class="line">                img[<span class="hljs-string">'src'</span>] = <span class="hljs-string">'https://web.telegram.org/a/'</span> + img_url.lstrip(<span class="hljs-string">'./'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 只保留不与 video 标签并列且不以 ./ 开头的 img 标签</span></span><br><span class="line">        filtered_img_tags = [</span><br><span class="line">            img <span class="hljs-keyword">for</span> img <span class="hljs-keyword">in</span> img_tags</span><br><span class="line">            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (img.find_previous_sibling(<span class="hljs-string">'video'</span>) <span class="hljs-keyword">or</span> img.find_next_sibling(<span class="hljs-string">'video'</span>))</span><br><span class="line">            <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> img.get(<span class="hljs-string">'src'</span>, <span class="hljs-string">''</span>).startswith(<span class="hljs-string">'./'</span>)</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        blob_img_count = <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> img <span class="hljs-keyword">in</span> filtered_img_tags <span class="hljs-keyword">if</span> img.get(<span class="hljs-string">'src'</span>) <span class="hljs-keyword">and</span> img.get(<span class="hljs-string">'src'</span>).startswith(<span class="hljs-string">'blob:'</span>))</span><br><span class="line">        total_blob_images += blob_img_count</span><br><span class="line">        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Found <span class="hljs-subst">{blob_img_count}</span> blob images in current div after filtering."</span>)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> i, img <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(filtered_img_tags):</span><br><span class="line">            img_url = img.get(<span class="hljs-string">'src'</span>)</span><br><span class="line">            <span class="hljs-keyword">if</span> img_url <span class="hljs-keyword">and</span> img_url.startswith(<span class="hljs-string">'blob:'</span>) <span class="hljs-keyword">and</span> <span class="hljs-string">'full-media'</span> <span class="hljs-keyword">in</span> img.get(<span class="hljs-string">'class'</span>, []):</span><br><span class="line">                message_div_id = div[<span class="hljs-string">'id'</span>]</span><br><span class="line">                imgxpath = (By.XPATH, <span class="hljs-string">f'(//div[@id="<span class="hljs-subst">{message_div_id}</span>"]//img[contains(@class, "full-media") and starts-with(@src, "blob:")])'</span>)</span><br><span class="line">                </span><br><span class="line">                img_element = tab.ele(imgxpath)</span><br><span class="line">                <span class="hljs-comment"># 检查是否存在多个符合条件的 img 标签</span></span><br><span class="line">                imgMorethan1xpath = (By.XPATH, <span class="hljs-string">f'(//div[@id="<span class="hljs-subst">{message_div_id}</span>"]//img[contains(@class, "full-media") and starts-with(@src, "blob:")])[2]'</span>)</span><br><span class="line">                img_element2 = tab.ele(imgMorethan1xpath)</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> img_element2:  <span class="hljs-comment"># 多个 blob 图片，使用 base64 下载</span></span><br><span class="line">                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Preparing to download multi imgs"</span>)</span><br><span class="line">                    file_name = img_url.split(<span class="hljs-string">'/'</span>)[-<span class="hljs-number">1</span>] + <span class="hljs-string">'.jpg'</span></span><br><span class="line">                    img_path = os.path.join(download_folder, file_name)</span><br><span class="line">                    </span><br><span class="line">                    <span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(max_retries):</span><br><span class="line">                        result = tab.run_js(<span class="hljs-string">f"""</span></span><br><span class="line"><span class="hljs-string">                            return fetch('<span class="hljs-subst">{img_url}</span>')</span></span><br><span class="line"><span class="hljs-string">                                .then(response =&gt; response.blob())</span></span><br><span class="line"><span class="hljs-string">                                .then(blob =&gt; {{</span></span><br><span class="line"><span class="hljs-string">                                    return new Promise((resolve, reject) =&gt; {{</span></span><br><span class="line"><span class="hljs-string">                                        const reader = new FileReader();</span></span><br><span class="line"><span class="hljs-string">                                        reader.onloadend = () =&gt; resolve(reader.result.split(',')[1]);</span></span><br><span class="line"><span class="hljs-string">                                        reader.onerror = reject;</span></span><br><span class="line"><span class="hljs-string">                                        reader.readAsDataURL(blob);</span></span><br><span class="line"><span class="hljs-string">                                    }});</span></span><br><span class="line"><span class="hljs-string">                                }});</span></span><br><span class="line"><span class="hljs-string">                        """</span>)</span><br><span class="line"></span><br><span class="line">                        img_data = base64.b64decode(result)  <span class="hljs-comment"># 转换为二进制数据</span></span><br><span class="line">                        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(img_path, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> img_file:</span><br><span class="line">                            img_file.write(img_data)</span><br><span class="line"></span><br><span class="line">                        time.sleep(<span class="hljs-number">1</span>)</span><br><span class="line">                        <span class="hljs-keyword">if</span> os.path.exists(img_path) <span class="hljs-keyword">and</span> os.path.getsize(img_path) &gt; <span class="hljs-number">0</span>:</span><br><span class="line">                            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Saved image to: <span class="hljs-subst">{img_path}</span>"</span>)</span><br><span class="line">                            <span class="hljs-keyword">break</span></span><br><span class="line">                        <span class="hljs-keyword">else</span>:</span><br><span class="line">                            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Retry <span class="hljs-subst">{attempt + <span class="hljs-number">1</span>}</span>/<span class="hljs-subst">{max_retries}</span> for image <span class="hljs-subst">{img_url}</span> failed."</span>)</span><br><span class="line">                            time.sleep(<span class="hljs-number">1</span>)</span><br><span class="line">                    <span class="hljs-keyword">else</span>:</span><br><span class="line">                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Failed to download image <span class="hljs-subst">{img_url}</span> after <span class="hljs-subst">{max_retries}</span> attempts."</span>)</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># 只有一张符合条件的图片，模拟右键下载</span></span><br><span class="line">                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Preparing to download single img: <span class="hljs-subst">{img_url}</span>"</span>)</span><br><span class="line">                    img_element.scroll.to_see()</span><br><span class="line">                    time.sleep(<span class="hljs-number">1</span>)</span><br><span class="line">                    tab.actions.r_click(img_element)</span><br><span class="line">                    <span class="hljs-comment"># img_element.click.right()</span></span><br><span class="line">                    time.sleep(<span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">                    downloadxpath = (By.XPATH, <span class="hljs-string">f'//div[@id="<span class="hljs-subst">{message_div_id}</span>"]//div[@class="MenuItem compact" and normalize-space(.) = "Download"]'</span>)</span><br><span class="line">                    download = tab.ele(downloadxpath)</span><br><span class="line"></span><br><span class="line">                    <span class="hljs-comment"># 设置下载路径和文件名</span></span><br><span class="line">                    tab.<span class="hljs-built_in">set</span>.download_path(download_folder)</span><br><span class="line">                    tab.<span class="hljs-built_in">set</span>.download_file_name(img_url.split(<span class="hljs-string">'/'</span>)[-<span class="hljs-number">1</span>].strip())</span><br><span class="line">                    download.click()</span><br><span class="line">                    time.sleep(<span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Total blob images found: <span class="hljs-subst">{total_blob_images}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">mute_autoplay_videos</span>(<span class="hljs-params">message_divs</span>):</span><br><span class="line">    <span class="hljs-keyword">for</span> div <span class="hljs-keyword">in</span> message_divs:</span><br><span class="line">        <span class="hljs-comment"># 找到所有 video 标签</span></span><br><span class="line">        video_tags = div.find_all(<span class="hljs-string">'video'</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="hljs-keyword">for</span> video <span class="hljs-keyword">in</span> video_tags:</span><br><span class="line">            <span class="hljs-comment"># 如果存在 autoplay 属性，替换为 autoplay muted</span></span><br><span class="line">            <span class="hljs-keyword">if</span> <span class="hljs-string">'autoplay'</span> <span class="hljs-keyword">in</span> video.attrs:</span><br><span class="line">                video[<span class="hljs-string">'muted'</span>] = <span class="hljs-string">''</span>  <span class="hljs-comment"># 添加 muted 属性</span></span><br><span class="line">                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Updated video tag: <span class="hljs-subst">{video}</span>"</span>)  <span class="hljs-comment"># 打印更新后的 video 标签</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">rename_file_extensions</span>(<span class="hljs-params">directory</span>):</span><br><span class="line">    <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> os.listdir(directory):</span><br><span class="line">        <span class="hljs-comment"># 分离文件名和扩展名</span></span><br><span class="line">        base, ext = os.path.splitext(filename)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 检查扩展名是否为 .MP4</span></span><br><span class="line">        <span class="hljs-keyword">if</span> ext == <span class="hljs-string">'.MP4'</span>:</span><br><span class="line">            <span class="hljs-comment"># 构造旧文件路径和新文件路径</span></span><br><span class="line">            old_file = os.path.join(directory, filename)</span><br><span class="line">            new_file = os.path.join(directory, base + <span class="hljs-string">'.mp4'</span>)</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment"># 如果文件已存在，则在文件名后添加序号</span></span><br><span class="line">            count = <span class="hljs-number">1</span></span><br><span class="line">            <span class="hljs-keyword">while</span> os.path.exists(new_file):</span><br><span class="line">                new_file = os.path.join(directory, <span class="hljs-string">f"<span class="hljs-subst">{base}</span>_<span class="hljs-subst">{count}</span>.mp4"</span>)</span><br><span class="line">                count += <span class="hljs-number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment"># 重命名文件</span></span><br><span class="line">            os.rename(old_file, new_file)</span><br><span class="line">            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Renamed <span class="hljs-subst">{filename}</span> to <span class="hljs-subst">{new_file}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 判断是否为非中文且非链接文本</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">is_non_chinese_and_non_link</span>(<span class="hljs-params">text</span>):</span><br><span class="line">    <span class="hljs-comment"># 检查文本是否不包含中文、链接，且不包含30个字符以内的英文字母和以@开头的英文字母</span></span><br><span class="line">    <span class="hljs-keyword">return</span> (</span><br><span class="line">        text <span class="hljs-keyword">and</span></span><br><span class="line">        <span class="hljs-keyword">not</span> re.search(<span class="hljs-string">r'[\u4e00-\u9fff]'</span>, text) <span class="hljs-keyword">and</span></span><br><span class="line">        <span class="hljs-string">'http'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> text <span class="hljs-keyword">and</span></span><br><span class="line">        <span class="hljs-string">'www'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> text <span class="hljs-keyword">and</span></span><br><span class="line">        <span class="hljs-keyword">not</span> re.search(<span class="hljs-string">r'^[a-zA-Z]{1,30}$'</span>, text) <span class="hljs-keyword">and</span>  <span class="hljs-comment"># 检查文本是否为1到30个字符的英文字母</span></span><br><span class="line">        <span class="hljs-keyword">not</span> re.search(<span class="hljs-string">r'^@[a-zA-Z]{1,30}$'</span>, text)    <span class="hljs-comment"># 检查文本是否以@开头并且为1到30个字符的英文字母</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 执行翻译并返回结果</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">translate_text</span>(<span class="hljs-params">text</span>):</span><br><span class="line">    translate_tab = tab.get_tab(url=<span class="hljs-string">'volcengine.com'</span>)</span><br><span class="line"></span><br><span class="line">    languageEn = (By.XPATH, <span class="hljs-string">"//div[@class='reverse']/following-sibling::div[@class='sc-ipEyDJ dqurTv']/div[@class='lang' and text()='英语']"</span>)</span><br><span class="line">    <span class="hljs-keyword">if</span> translate_tab.ele(languageEn):</span><br><span class="line">        <span class="hljs-built_in">print</span>(<span class="hljs-string">"由于不明原因改成翻译为英文"</span>)</span><br><span class="line">        translate_tab.ele(languageEn).click()</span><br><span class="line">        time.sleep(<span class="hljs-number">2</span>)</span><br><span class="line">        language2 = (By.XPATH, <span class="hljs-string">"//div[@class='lang-search-recently']/div[@data-lang='zh']"</span>)</span><br><span class="line">        language_option = translate_tab.ele(language2)</span><br><span class="line">        language_option.click()</span><br><span class="line">        <span class="hljs-built_in">print</span>(<span class="hljs-string">"强制改为翻译成中文"</span>)</span><br><span class="line"></span><br><span class="line">    result1 = (By.XPATH, <span class="hljs-string">"//div[@class='slate-editor' and @contenteditable='false']"</span>)</span><br><span class="line">    translated_text = translate_tab.ele(result1)</span><br><span class="line">    input1 = (By.XPATH, <span class="hljs-string">'//div[@role="textbox" and @aria-multiline="true" and contains(@class, "slate-editor")]'</span>)</span><br><span class="line">    input_box = translate_tab.ele(input1)</span><br><span class="line">    input_box.clear()</span><br><span class="line">    input_box.<span class="hljs-built_in">input</span>(text)</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="hljs-number">5</span>)</span><br><span class="line">    <span class="hljs-comment"># print("translated_text为：" + translated_text.text)</span></span><br><span class="line">    <span class="hljs-keyword">return</span> translated_text.text</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 处理网页内容</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">process_webpage</span>(<span class="hljs-params">url_base, message_limit</span>):</span><br><span class="line">    <span class="hljs-comment"># 指定输出文件路径</span></span><br><span class="line">    output_file_path = <span class="hljs-string">r'D:\hexoblog\source\telegram\telegram_translated_messages.html'</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 创建文件并写入 HTML 内容</span></span><br><span class="line">    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file_path, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> file:</span><br><span class="line">        <span class="hljs-comment"># 写入 HTML 模板</span></span><br><span class="line">        file.write(<span class="hljs-string">"""&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="hljs-string">&lt;html&gt;</span></span><br><span class="line"><span class="hljs-string">&lt;head&gt;</span></span><br><span class="line"><span class="hljs-string">    &lt;meta charset="UTF-8"&gt;</span></span><br><span class="line"><span class="hljs-string">    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></span><br><span class="line"><span class="hljs-string">    &lt;title&gt;Telegram Styled Message&lt;/title&gt;</span></span><br><span class="line"><span class="hljs-string">    &lt;link rel="stylesheet" href="telegram2.css"&gt;</span></span><br><span class="line"><span class="hljs-string">    &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"&gt;</span></span><br><span class="line"><span class="hljs-string">&lt;/head&gt;</span></span><br><span class="line"><span class="hljs-string"></span></span><br><span class="line"><span class="hljs-string">&lt;script type="text/javascript"&gt;</span></span><br><span class="line"><span class="hljs-string">    document.addEventListener("DOMContentLoaded", function() {</span></span><br><span class="line"><span class="hljs-string">    const lazyElements = document.querySelectorAll('.lazy');</span></span><br><span class="line"><span class="hljs-string"></span></span><br><span class="line"><span class="hljs-string">    const observer = new IntersectionObserver((entries, observer) =&gt; {</span></span><br><span class="line"><span class="hljs-string">        entries.forEach(entry =&gt; {</span></span><br><span class="line"><span class="hljs-string">            if (entry.isIntersecting) {</span></span><br><span class="line"><span class="hljs-string">                const el = entry.target;</span></span><br><span class="line"><span class="hljs-string">                const src = el.getAttribute('data-src');</span></span><br><span class="line"><span class="hljs-string">                if (src) {</span></span><br><span class="line"><span class="hljs-string">                    if (el.tagName === 'IMG' || el.tagName === 'VIDEO') {</span></span><br><span class="line"><span class="hljs-string">                        el.src = src;</span></span><br><span class="line"><span class="hljs-string">                        el.removeAttribute('data-src'); // 移除 data-src</span></span><br><span class="line"><span class="hljs-string">                    }</span></span><br><span class="line"><span class="hljs-string">                    observer.unobserve(el); // 停止观察已加载元素</span></span><br><span class="line"><span class="hljs-string">                }</span></span><br><span class="line"><span class="hljs-string">            }</span></span><br><span class="line"><span class="hljs-string">        });</span></span><br><span class="line"><span class="hljs-string">    }, { rootMargin: "0px 0px 200px 0px" }); // 提前 200px 加载</span></span><br><span class="line"><span class="hljs-string"></span></span><br><span class="line"><span class="hljs-string">    lazyElements.forEach(el =&gt; observer.observe(el));</span></span><br><span class="line"><span class="hljs-string">});</span></span><br><span class="line"><span class="hljs-string"></span></span><br><span class="line"><span class="hljs-string">&lt;/script&gt;</span></span><br><span class="line"><span class="hljs-string">&lt;body&gt;</span></span><br><span class="line"><span class="hljs-string">"""</span>)  <span class="hljs-comment"># 开始写入 HTML 模板</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"># 遍历编号数组</span></span><br><span class="line">    <span class="hljs-keyword">for</span> chat_id <span class="hljs-keyword">in</span> chat_ids:</span><br><span class="line">        <span class="hljs-comment"># 拼接URL和menu XPATH</span></span><br><span class="line">        url = url_base + chat_id</span><br><span class="line">        tab.get(url)</span><br><span class="line">        time.sleep(<span class="hljs-number">3</span>)  <span class="hljs-comment"># 等待页面加载</span></span><br><span class="line">        menu1 = (By.XPATH, <span class="hljs-string">f'//a[@href="#-<span class="hljs-subst">{chat_id}</span>"]'</span>)</span><br><span class="line">        menu_list = tab.ele(menu1)</span><br><span class="line">        time.sleep(<span class="hljs-number">1</span>)</span><br><span class="line">        menu_list.click()</span><br><span class="line"></span><br><span class="line">        button1 = (By.XPATH, <span class="hljs-string">'//div[@class="Y2NKrpKj u62x81QI"]/button'</span>)</span><br><span class="line">        buttondown = tab.ele(button1)</span><br><span class="line">        buttondown.click()</span><br><span class="line">        time.sleep(<span class="hljs-number">3</span>)</span><br><span class="line">        container1 = (By.XPATH, <span class="hljs-string">'//div[@class="messages-container"]'</span>)</span><br><span class="line">        messages_container = tab.ele(container1)</span><br><span class="line">        time.sleep(<span class="hljs-number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 使用BeautifulSoup解析HTML</span></span><br><span class="line">        soup = BeautifulSoup(messages_container.html, <span class="hljs-string">'html.parser'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 删除不需要的元素</span></span><br><span class="line">        <span class="hljs-keyword">for</span> meta_span <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'span'</span>, class_=<span class="hljs-string">'MessageMeta'</span>):</span><br><span class="line">            meta_span.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> message_title <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'span'</span>, class_=<span class="hljs-string">'message-title-name'</span>):</span><br><span class="line">            message_title.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> video_duration <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'message-media-duration'</span>):</span><br><span class="line">            video_duration.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> button_react <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'button'</span>, class_=<span class="hljs-string">'message-reaction'</span>):</span><br><span class="line">            button_react.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> reply <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'CommentButton'</span>):</span><br><span class="line">            reply.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> reply2 <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'recent-repliers'</span>):</span><br><span class="line">            reply2.decompose()</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 提取 message-list-item 中的消息</span></span><br><span class="line">        message_divs = soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'message-list-item'</span>, <span class="hljs-built_in">id</span>=<span class="hljs-keyword">lambda</span> x: x <span class="hljs-keyword">and</span> x.startswith(<span class="hljs-string">'message-'</span>))</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 提取 id 中的数字部分并排序</span></span><br><span class="line">        message_divs_sorted = <span class="hljs-built_in">sorted</span>(</span><br><span class="line">            message_divs,</span><br><span class="line">            key=<span class="hljs-keyword">lambda</span> div: <span class="hljs-built_in">int</span>(div[<span class="hljs-string">'id'</span>].split(<span class="hljs-string">'-'</span>)[<span class="hljs-number">1</span>]),</span><br><span class="line">            reverse=<span class="hljs-literal">True</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 根据指定的消息数量保留消息</span></span><br><span class="line">        top_limit_message_divs = message_divs_sorted[:message_limit]</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> message_div <span class="hljs-keyword">in</span> top_limit_message_divs:</span><br><span class="line">            element = tab.ele(<span class="hljs-string">f'@id=<span class="hljs-subst">{message_div[<span class="hljs-string">'id'</span>]}</span>'</span>)</span><br><span class="line">            element.scroll.to_see()</span><br><span class="line">            time.sleep(<span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">        buttondown.click()</span><br><span class="line">        time.sleep(<span class="hljs-number">3</span>)</span><br><span class="line">        container1 = (By.XPATH, <span class="hljs-string">'//div[@class="messages-container"]'</span>)</span><br><span class="line">        messages_container = tab.ele(container1)</span><br><span class="line">        time.sleep(<span class="hljs-number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 使用BeautifulSoup解析HTML</span></span><br><span class="line">        soup = BeautifulSoup(messages_container.html, <span class="hljs-string">'html.parser'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 删除不需要的元素</span></span><br><span class="line">        <span class="hljs-keyword">for</span> meta_span <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'span'</span>, class_=<span class="hljs-string">'MessageMeta'</span>):</span><br><span class="line">            meta_span.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> message_title <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'span'</span>, class_=<span class="hljs-string">'message-title-name'</span>):</span><br><span class="line">            message_title.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> video_duration <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'message-media-duration'</span>):</span><br><span class="line">            video_duration.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> button_react <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'button'</span>, class_=<span class="hljs-string">'message-reaction'</span>):</span><br><span class="line">            button_react.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> reply <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'CommentButton'</span>):</span><br><span class="line">            reply.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> reply2 <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'recent-repliers'</span>):</span><br><span class="line">            reply2.decompose()</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 提取 message-list-item 中的消息</span></span><br><span class="line">        message_divs = soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'message-list-item'</span>, <span class="hljs-built_in">id</span>=<span class="hljs-keyword">lambda</span> x: x <span class="hljs-keyword">and</span> x.startswith(<span class="hljs-string">'message-'</span>))</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 提取 id 中的数字部分并排序</span></span><br><span class="line">        message_divs_sorted = <span class="hljs-built_in">sorted</span>(</span><br><span class="line">            message_divs,</span><br><span class="line">            key=<span class="hljs-keyword">lambda</span> div: <span class="hljs-built_in">int</span>(div[<span class="hljs-string">'id'</span>].split(<span class="hljs-string">'-'</span>)[<span class="hljs-number">1</span>]),</span><br><span class="line">            reverse=<span class="hljs-literal">True</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 根据指定的消息数量保留消息</span></span><br><span class="line">        top_limit_message_divs = message_divs_sorted[:message_limit]</span><br><span class="line">        <span class="hljs-comment"># min_message_div = min(top_limit_message_divs, key=lambda div: int(div['id'].split('-')[1]))</span></span><br><span class="line"></span><br><span class="line">        total_videos = <span class="hljs-number">0</span></span><br><span class="line">        total_imgs = <span class="hljs-number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> message_div <span class="hljs-keyword">in</span> top_limit_message_divs:</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment"># 先处理 text-content</span></span><br><span class="line">            <span class="hljs-built_in">print</span>(<span class="hljs-string">"处理text-content"</span>)</span><br><span class="line">            text_content_divs = message_div.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'text-content'</span>)</span><br><span class="line">            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"当前的message_div的id为<span class="hljs-subst">{message_div[<span class="hljs-string">'id'</span>]}</span>"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">for</span> div <span class="hljs-keyword">in</span> text_content_divs:</span><br><span class="line">                text_content_list = []</span><br><span class="line">                <span class="hljs-keyword">for</span> text_content <span class="hljs-keyword">in</span> div.find_all(text=<span class="hljs-literal">True</span>):</span><br><span class="line">                    stripped_text = text_content.strip()  <span class="hljs-comment"># 去除两端空格</span></span><br><span class="line">                    <span class="hljs-keyword">if</span> is_non_chinese_and_non_link(stripped_text):</span><br><span class="line">                        text_content_list.append(stripped_text)</span><br><span class="line"></span><br><span class="line">                combined_text = <span class="hljs-string">'\n'</span>.join(text_content_list)</span><br><span class="line">                <span class="hljs-keyword">if</span> combined_text:</span><br><span class="line">                    <span class="hljs-comment"># print(f"Processing text-content combined_text: {combined_text}")</span></span><br><span class="line">                    translated_text = translate_text(combined_text)</span><br><span class="line"></span><br><span class="line">                    <span class="hljs-comment"># 将 translated_text 转义成 JavaScript 字符串</span></span><br><span class="line">                    safe_translated_text = json.dumps(<span class="hljs-string">f'&lt;p style="color: purple;"&gt;<span class="hljs-subst">{translated_text}</span>&lt;/p&gt;'</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="hljs-comment"># 使用原文内容匹配的 XPath 查询，找到浏览器中的目标元素</span></span><br><span class="line">                    target_div = tab.ele((By.XPATH, <span class="hljs-string">f"//div[contains(@class, 'text-content') and contains(., '<span class="hljs-subst">{text_content_list[<span class="hljs-number">0</span>]}</span>')][not(@data-translated)]"</span>))</span><br><span class="line"></span><br><span class="line">                    <span class="hljs-keyword">if</span> target_div:</span><br><span class="line">                        target_div.run_js(<span class="hljs-string">"this.setAttribute('data-translated', 'true');"</span>)</span><br><span class="line">                        target_div.run_js(<span class="hljs-string">f"""</span></span><br><span class="line"><span class="hljs-string">                            function insertAfter(newElement, targetElement) {{</span></span><br><span class="line"><span class="hljs-string">                                var parentElement = targetElement.parentNode;</span></span><br><span class="line"><span class="hljs-string">                                if (parentElement.lastChild === targetElement) {{</span></span><br><span class="line"><span class="hljs-string">                                    parentElement.appendChild(newElement);</span></span><br><span class="line"><span class="hljs-string">                                }} else {{</span></span><br><span class="line"><span class="hljs-string">                                    parentElement.insertBefore(newElement, targetElement.nextSibling);</span></span><br><span class="line"><span class="hljs-string">                                }}</span></span><br><span class="line"><span class="hljs-string">                            }}</span></span><br><span class="line"><span class="hljs-string">                            </span></span><br><span class="line"><span class="hljs-string">                            var transDiv = document.createElement('div');</span></span><br><span class="line"><span class="hljs-string">                            transDiv.className = 'translated_text';</span></span><br><span class="line"><span class="hljs-string">                            transDiv.innerHTML = <span class="hljs-subst">{safe_translated_text}</span>;</span></span><br><span class="line"><span class="hljs-string">                            </span></span><br><span class="line"><span class="hljs-string">                            insertAfter(transDiv, this);</span></span><br><span class="line"><span class="hljs-string">                        """</span>)</span><br><span class="line">                    <span class="hljs-keyword">else</span>:</span><br><span class="line">                        <span class="hljs-built_in">print</span>(<span class="hljs-string">"未能找到任何元素 for text-content"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment"># 处理 WebPage-text</span></span><br><span class="line">            <span class="hljs-built_in">print</span>(<span class="hljs-string">"处理WebPage-text"</span>)</span><br><span class="line">            webpage_text_divs = message_div.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'WebPage-text'</span>)</span><br><span class="line">            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"当前的message_div的id为<span class="hljs-subst">{message_div[<span class="hljs-string">'id'</span>]}</span>"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">for</span> div <span class="hljs-keyword">in</span> webpage_text_divs:</span><br><span class="line">                text_content_list = []</span><br><span class="line">                <span class="hljs-keyword">for</span> text_content <span class="hljs-keyword">in</span> div.find_all(text=<span class="hljs-literal">True</span>):</span><br><span class="line">                    stripped_text = text_content.strip()  <span class="hljs-comment"># 去除两端空格</span></span><br><span class="line">                    <span class="hljs-keyword">if</span> is_non_chinese_and_non_link(stripped_text):</span><br><span class="line">                        text_content_list.append(stripped_text)</span><br><span class="line"></span><br><span class="line">                combined_text = <span class="hljs-string">'\n'</span>.join(text_content_list)</span><br><span class="line">                <span class="hljs-keyword">if</span> combined_text:</span><br><span class="line">                    <span class="hljs-comment"># print(f"Processing WebPage-text combined_text: {combined_text}")</span></span><br><span class="line">                    translated_text = translate_text(combined_text)</span><br><span class="line"></span><br><span class="line">                    <span class="hljs-comment"># 将 translated_text 转义成 JavaScript 字符串</span></span><br><span class="line">                    safe_translated_text = json.dumps(<span class="hljs-string">f'&lt;p style="color: purple;"&gt;<span class="hljs-subst">{translated_text}</span>&lt;/p&gt;'</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="hljs-comment"># 使用原文内容匹配的 XPath 查询，找到浏览器中的目标元素</span></span><br><span class="line"></span><br><span class="line">                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(text_content_list) &gt; <span class="hljs-number">1</span>:</span><br><span class="line">                        <span class="hljs-comment"># 尝试使用 text_content_list[1]</span></span><br><span class="line">                        target_div = tab.ele((By.XPATH, <span class="hljs-string">f"//div[contains(@class, 'WebPage-text') and contains(., '<span class="hljs-subst">{text_content_list[<span class="hljs-number">1</span>]}</span>')][not(@data-translated)]"</span>))</span><br><span class="line">                    <span class="hljs-keyword">else</span>:</span><br><span class="line">                        <span class="hljs-comment"># 如果 text_content_list[1] 不存在，使用 text_content_list[0]</span></span><br><span class="line">                        target_div = tab.ele((By.XPATH, <span class="hljs-string">f"//div[contains(@class, 'WebPage-text') and contains(., '<span class="hljs-subst">{text_content_list[<span class="hljs-number">0</span>]}</span>')][not(@data-translated)]"</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    <span class="hljs-keyword">if</span> target_div:</span><br><span class="line">                        target_div.run_js(<span class="hljs-string">"this.setAttribute('data-translated', 'true');"</span>)</span><br><span class="line">                        target_div.run_js(<span class="hljs-string">f"""</span></span><br><span class="line"><span class="hljs-string">                            function insertAfter(newElement, targetElement) {{</span></span><br><span class="line"><span class="hljs-string">                                var parentElement = targetElement.parentNode;</span></span><br><span class="line"><span class="hljs-string">                                if (parentElement.lastChild === targetElement) {{</span></span><br><span class="line"><span class="hljs-string">                                    parentElement.appendChild(newElement);</span></span><br><span class="line"><span class="hljs-string">                                }} else {{</span></span><br><span class="line"><span class="hljs-string">                                    parentElement.insertBefore(newElement, targetElement.nextSibling);</span></span><br><span class="line"><span class="hljs-string">                                }}</span></span><br><span class="line"><span class="hljs-string">                            }}</span></span><br><span class="line"><span class="hljs-string">                            </span></span><br><span class="line"><span class="hljs-string">                            var transDiv = document.createElement('div');</span></span><br><span class="line"><span class="hljs-string">                            transDiv.className = 'translated_text';</span></span><br><span class="line"><span class="hljs-string">                            transDiv.innerHTML = <span class="hljs-subst">{safe_translated_text}</span>;</span></span><br><span class="line"><span class="hljs-string">                            </span></span><br><span class="line"><span class="hljs-string">                            insertAfter(transDiv, this);</span></span><br><span class="line"><span class="hljs-string">                        """</span>)</span><br><span class="line">                    <span class="hljs-keyword">else</span>:</span><br><span class="line">                        <span class="hljs-built_in">print</span>(<span class="hljs-string">"未能找到任何元素 for WebPage-text"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> message_div <span class="hljs-keyword">in</span> top_limit_message_divs:</span><br><span class="line">            element = tab.ele(<span class="hljs-string">f'@id=<span class="hljs-subst">{message_div[<span class="hljs-string">'id'</span>]}</span>'</span>)</span><br><span class="line">            element.scroll.to_see()</span><br><span class="line">            time.sleep(<span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">        soup = BeautifulSoup(messages_container.html, <span class="hljs-string">'html.parser'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 删除不需要的元素</span></span><br><span class="line">        <span class="hljs-keyword">for</span> meta_span <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'span'</span>, class_=<span class="hljs-string">'MessageMeta'</span>):</span><br><span class="line">            meta_span.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> message_title <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'span'</span>, class_=<span class="hljs-string">'message-title-name'</span>):</span><br><span class="line">            message_title.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> video_duration <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'message-media-duration'</span>):</span><br><span class="line">            video_duration.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> button_react <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'button'</span>, class_=<span class="hljs-string">'message-reaction'</span>):</span><br><span class="line">            button_react.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> reply <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'CommentButton'</span>):</span><br><span class="line">            reply.decompose()</span><br><span class="line">        <span class="hljs-keyword">for</span> reply2 <span class="hljs-keyword">in</span> soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'recent-repliers'</span>):</span><br><span class="line">            reply2.decompose()</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 提取 message-list-item 中的消息</span></span><br><span class="line">        message_divs = soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'message-list-item'</span>, <span class="hljs-built_in">id</span>=<span class="hljs-keyword">lambda</span> x: x <span class="hljs-keyword">and</span> x.startswith(<span class="hljs-string">'message-'</span>))</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 提取 id 中的数字部分并排序</span></span><br><span class="line">        message_divs_sorted = <span class="hljs-built_in">sorted</span>(</span><br><span class="line">            message_divs,</span><br><span class="line">            key=<span class="hljs-keyword">lambda</span> div: <span class="hljs-built_in">int</span>(div[<span class="hljs-string">'id'</span>].split(<span class="hljs-string">'-'</span>)[<span class="hljs-number">1</span>]),</span><br><span class="line">            reverse=<span class="hljs-literal">True</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"># 根据指定的消息数量保留消息</span></span><br><span class="line">        top_limit_message_divs = message_divs_sorted[:message_limit]</span><br><span class="line">        </span><br><span class="line">        download_folder = <span class="hljs-string">r'D:\hexoblog\source\telegram'</span></span><br><span class="line">        download_images(top_limit_message_divs, download_folder)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> div <span class="hljs-keyword">in</span> top_limit_message_divs:</span><br><span class="line">            <span class="hljs-comment"># 找到所有 img 标签</span></span><br><span class="line">            img_tags = div.find_all(<span class="hljs-string">'img'</span>)</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">for</span> img <span class="hljs-keyword">in</span> img_tags:</span><br><span class="line">                img_url = img.get(<span class="hljs-string">'src'</span>)</span><br><span class="line">                <span class="hljs-keyword">if</span> img_url <span class="hljs-keyword">and</span> img_url.startswith(<span class="hljs-string">'blob:'</span>):</span><br><span class="line">                    <span class="hljs-comment"># 获取图片的文件名并添加后缀</span></span><br><span class="line">                    new_img_url = img_url.split(<span class="hljs-string">'/'</span>)[-<span class="hljs-number">1</span>] + <span class="hljs-string">".jpg"</span></span><br><span class="line">                    <span class="hljs-comment"># 修改 img 的 src 属性为 data-src</span></span><br><span class="line">                    img[<span class="hljs-string">'data-src'</span>] = new_img_url</span><br><span class="line">                    <span class="hljs-comment"># 删除原有的 src 属性</span></span><br><span class="line">                    <span class="hljs-keyword">del</span> img[<span class="hljs-string">'src'</span>]</span><br><span class="line">                    <span class="hljs-keyword">if</span> <span class="hljs-string">'full-media'</span> <span class="hljs-keyword">in</span> img[<span class="hljs-string">'class'</span>]:</span><br><span class="line">                        <span class="hljs-comment"># 如果 'lazy' 不在 class 列表中，则添加</span></span><br><span class="line">                        <span class="hljs-keyword">if</span> <span class="hljs-string">'lazy'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> img[<span class="hljs-string">'class'</span>]:</span><br><span class="line">                            img[<span class="hljs-string">'class'</span>].append(<span class="hljs-string">'lazy'</span>)</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">if</span> img_url <span class="hljs-keyword">and</span> img_url.startswith(<span class="hljs-string">'./'</span>):</span><br><span class="line">                    <span class="hljs-comment"># 将 './' 替换为完整路径</span></span><br><span class="line">                    img_url = <span class="hljs-string">'https://web.telegram.org/a/'</span> + img_url.lstrip(<span class="hljs-string">'./'</span>)</span><br><span class="line">                    img[<span class="hljs-string">'src'</span>] = img_url</span><br><span class="line"></span><br><span class="line">        max_retries = <span class="hljs-number">25</span></span><br><span class="line">        <span class="hljs-keyword">for</span> message_div <span class="hljs-keyword">in</span> top_limit_message_divs:</span><br><span class="line">            <span class="hljs-comment"># 获取当前 message_div 的视频标签</span></span><br><span class="line">            video_tags = message_div.find_all(<span class="hljs-string">'video'</span>)</span><br><span class="line">            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Video tags found:"</span>, video_tags)</span><br><span class="line"></span><br><span class="line">            video_count = <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> video <span class="hljs-keyword">in</span> video_tags <span class="hljs-keyword">if</span> video.get(<span class="hljs-string">'src'</span>))</span><br><span class="line">            total_videos += video_count</span><br><span class="line">            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Found <span class="hljs-subst">{video_count}</span> videos in current div."</span>)</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> video_count &gt; <span class="hljs-number">0</span>:  <span class="hljs-comment"># 确保当前 div 中有视频</span></span><br><span class="line">                <span class="hljs-keyword">for</span> video <span class="hljs-keyword">in</span> video_tags:  <span class="hljs-comment"># 遍历每个视频</span></span><br><span class="line">                    video_src = video.get(<span class="hljs-string">'src'</span>)</span><br><span class="line">                    <span class="hljs-keyword">if</span> video_src <span class="hljs-keyword">and</span> video_src.startswith(<span class="hljs-string">'./progressive/document'</span>):</span><br><span class="line">                        <span class="hljs-comment"># 提取文件名</span></span><br><span class="line">                        file_name = video_src.replace(<span class="hljs-string">'./progressive/document'</span>, <span class="hljs-string">''</span>).strip()</span><br><span class="line">                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Preparing to download video with filename: <span class="hljs-subst">{file_name}</span>"</span>)</span><br><span class="line"></span><br><span class="line">                        <span class="hljs-comment"># 定义视频标签的 XPath</span></span><br><span class="line">                        message_div_id = message_div[<span class="hljs-string">'id'</span>]</span><br><span class="line">                        videoxpath = (By.XPATH, <span class="hljs-string">f'//div[@id="<span class="hljs-subst">{message_div_id}</span>"]//video'</span>)</span><br><span class="line">                        video_element = tab.ele(videoxpath)  <span class="hljs-comment"># 获取视频元素</span></span><br><span class="line"></span><br><span class="line">                        <span class="hljs-comment"># 模拟右键点击</span></span><br><span class="line">                        tab.actions.r_click(video_element)</span><br><span class="line">                        time.sleep(<span class="hljs-number">1</span>)  <span class="hljs-comment"># 等待菜单出现</span></span><br><span class="line"></span><br><span class="line">                        <span class="hljs-comment"># 定义下载选项的 XPath</span></span><br><span class="line">                        downloadxpath = (By.XPATH, <span class="hljs-string">f'//div[@id="<span class="hljs-subst">{message_div_id}</span>"]//div[@class="MenuItem compact" and normalize-space(.) = "Download"]'</span>)</span><br><span class="line">                        download = tab.ele(downloadxpath)  <span class="hljs-comment"># 获取下载按钮</span></span><br><span class="line"></span><br><span class="line">                        retries = <span class="hljs-number">0</span></span><br><span class="line">                        <span class="hljs-keyword">while</span> retries &lt; max_retries:</span><br><span class="line">                            <span class="hljs-keyword">try</span>:</span><br><span class="line">                                <span class="hljs-comment"># 设置下载路径和文件名</span></span><br><span class="line">                                tab.<span class="hljs-built_in">set</span>.download_path(<span class="hljs-string">r'D:\hexoblog\source\telegram'</span>)  <span class="hljs-comment"># 设置文件保存路径</span></span><br><span class="line">                                tab.<span class="hljs-built_in">set</span>.download_file_name(file_name)  <span class="hljs-comment"># 设置重命名文件名</span></span><br><span class="line">                                time.sleep(<span class="hljs-number">1</span>)</span><br><span class="line">                                download.click()</span><br><span class="line">                                </span><br><span class="line">                                <span class="hljs-comment"># 修改视频标签属性</span></span><br><span class="line">                                video_src = file_name + <span class="hljs-string">".mp4"</span></span><br><span class="line">                                video[<span class="hljs-string">'data-src'</span>] = video_src</span><br><span class="line">                                <span class="hljs-keyword">del</span> video[<span class="hljs-string">'src'</span>]</span><br><span class="line">                                video[<span class="hljs-string">'class'</span>] = <span class="hljs-string">'full-media lazy'</span></span><br><span class="line">                                </span><br><span class="line">                                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Downloaded <span class="hljs-subst">{file_name}</span> successfully."</span>)</span><br><span class="line">                                <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 成功完成后跳出重试循环</span></span><br><span class="line">                            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:</span><br><span class="line">                                retries += <span class="hljs-number">1</span></span><br><span class="line">                                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"错误: <span class="hljs-subst">{e}</span>. 重试 (<span class="hljs-subst">{retries}</span>/<span class="hljs-subst">{max_retries}</span>)..."</span>)</span><br><span class="line">                                time.sleep(<span class="hljs-number">3</span>)  <span class="hljs-comment"># 等待 5 秒再重试</span></span><br><span class="line">                        <span class="hljs-keyword">else</span>:</span><br><span class="line">                            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Failed to download <span class="hljs-subst">{file_name}</span> after <span class="hljs-subst">{max_retries}</span> attempts."</span>)</span><br><span class="line">                            </span><br><span class="line">                        <span class="hljs-comment"># 可选：等待下载完成</span></span><br><span class="line">                        time.sleep(<span class="hljs-number">15</span>)  <span class="hljs-comment"># 根据下载时间进行调整</span></span><br><span class="line"></span><br><span class="line">        mute_autoplay_videos(top_limit_message_divs)</span><br><span class="line"></span><br><span class="line">        directory_path = <span class="hljs-string">"D:/hexoblog/source/telegram"</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> os.listdir(directory_path):</span><br><span class="line">            <span class="hljs-comment"># 检查文件名前缀是否为 'video'</span></span><br><span class="line">            <span class="hljs-keyword">if</span> filename.startswith(<span class="hljs-string">"video"</span>):</span><br><span class="line">                <span class="hljs-comment"># 构造新的文件名（移除 'video' 前缀）</span></span><br><span class="line">                new_filename = filename[<span class="hljs-built_in">len</span>(<span class="hljs-string">"video"</span>):]</span><br><span class="line">                </span><br><span class="line">                <span class="hljs-comment"># 构造旧文件路径和新文件路径</span></span><br><span class="line">                old_file = os.path.join(directory_path, filename)</span><br><span class="line">                new_file = os.path.join(directory_path, new_filename)</span><br><span class="line"></span><br><span class="line">                <span class="hljs-comment"># 如果新文件名已存在，添加一个序号后缀</span></span><br><span class="line">                count = <span class="hljs-number">1</span></span><br><span class="line">                <span class="hljs-keyword">while</span> os.path.exists(new_file):</span><br><span class="line">                    new_file = os.path.join(directory_path, <span class="hljs-string">f"<span class="hljs-subst">{new_filename}</span>_<span class="hljs-subst">{count}</span>"</span>)</span><br><span class="line">                    count += <span class="hljs-number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="hljs-comment"># 重命名文件</span></span><br><span class="line">                os.rename(old_file, new_file)</span><br><span class="line">                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Renamed <span class="hljs-subst">{filename}</span> to <span class="hljs-subst">{new_file}</span>"</span>)</span><br><span class="line"></span><br><span class="line">        rename_file_extensions(directory_path)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> os.listdir(directory_path):</span><br><span class="line">            <span class="hljs-comment"># 检查文件是否以 '_1' 结尾并且紧接着文件扩展名</span></span><br><span class="line">            <span class="hljs-keyword">if</span> filename.endswith(<span class="hljs-string">'_1.mp4'</span>) <span class="hljs-keyword">or</span> filename.endswith(<span class="hljs-string">'_1.MOV'</span>):</span><br><span class="line">                <span class="hljs-comment"># 移除文件名中的 '_1'</span></span><br><span class="line">                new_filename = filename.replace(<span class="hljs-string">'_1'</span>, <span class="hljs-string">''</span>, <span class="hljs-number">1</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="hljs-comment"># 构建旧文件和新文件的完整路径</span></span><br><span class="line">                old_file = os.path.join(directory_path, filename)</span><br><span class="line">                new_file = os.path.join(directory_path, new_filename)</span><br><span class="line">                </span><br><span class="line">                <span class="hljs-comment"># 检查是否存在同名文件，若存在则添加后缀 '_new' 或编号</span></span><br><span class="line">                count = <span class="hljs-number">1</span></span><br><span class="line">                <span class="hljs-keyword">while</span> os.path.exists(new_file):</span><br><span class="line">                    name, ext = os.path.splitext(new_filename)</span><br><span class="line">                    new_file = os.path.join(directory_path, <span class="hljs-string">f"<span class="hljs-subst">{name}</span>_new<span class="hljs-subst">{count}</span><span class="hljs-subst">{ext}</span>"</span>)</span><br><span class="line">                    count += <span class="hljs-number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="hljs-comment"># 重命名文件</span></span><br><span class="line">                os.rename(old_file, new_file)</span><br><span class="line">                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Renamed <span class="hljs-subst">{filename}</span> to <span class="hljs-subst">{new_file}</span>"</span>)</span><br><span class="line">            <span class="hljs-keyword">else</span>:</span><br><span class="line">                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Skipping <span class="hljs-subst">{filename}</span>, does not match pattern."</span>)</span><br><span class="line"></span><br><span class="line">        translated_text_divs = <span class="hljs-string">''</span>.join(<span class="hljs-built_in">str</span>(div) <span class="hljs-keyword">for</span> div <span class="hljs-keyword">in</span> top_limit_message_divs)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> div <span class="hljs-keyword">in</span> translated_text_divs:</span><br><span class="line">            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file_path, <span class="hljs-string">'a'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> file:</span><br><span class="line">                file.write(<span class="hljs-built_in">str</span>(div))  <span class="hljs-comment"># 将每个 div 的 HTML 内容写入文件</span></span><br><span class="line">            </span><br><span class="line">    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file_path, <span class="hljs-string">'a'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> file:</span><br><span class="line">            file.write(<span class="hljs-string">"\n&lt;/body&gt;\n&lt;/html&gt;"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Translated messages saved to <span class="hljs-subst">{output_file_path}</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chat_ids = [<span class="hljs-string">'1001036240821'</span>, <span class="hljs-string">'1001374600389'</span>, <span class="hljs-string">'1001576917998'</span>, <span class="hljs-string">'1001375124677'</span>, <span class="hljs-string">'1001001746107'</span>, <span class="hljs-string">'1001394050290'</span>]</span><br><span class="line">url_base = <span class="hljs-string">'https://web.telegram.org/a/#-'</span></span><br><span class="line">message_limit = <span class="hljs-number">25</span></span><br><span class="line"></span><br><span class="line">process_webpage(url_base, message_limit)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>


</body></html>
    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/telegram/">#telegram</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/%E5%AA%92%E4%BD%93%E6%96%B0%E9%97%BB/">#媒体新闻</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/python/">#python</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop is-hidden-mobile article-nav-prev">
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2024/11/03/2024-10-8/">2024-10-8-SendToUE第2个医院</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">评论</h3>
    
<div id="valine-thread"></div>

<style>
.v[data-class="v"] .veditor {
    max-height: 17em;
    overflow-y: scroll;
}

/* 去除查看更多 */
.v[data-class="v"] .vcards .vcard .vcontent.expand {
    max-height: none;
}

.v[data-class="v"] .vcards .vcard .vcontent.expand::before,
.v[data-class="v"] .vcards .vcard .vcontent.expand::after {
    display: none;
}

</style>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script src="https://cdn.jsdelivr.net/gh/flatblowfish/cave-draw/dist/cave-draw.min.js"></script>

<script>
    new Valine({
        el: '#valine-thread',
        appId: 'iPPfF8Jwk6zoVuC8yAJLVdLT-gzGzoHsz',
        appKey: 'D78M0CStPxwTiqW2ql4mmhrA',
        notify: false,
        verify: false,
        avatar: 'mp',
        placeholder: '想到什么说什么',
        meta: ['nick', 'mail'],
        visitor: true,
        lang: 'zh-CN'
    })

var count = 0;
var dom_timer = setInterval(function () {
	if (++count > 50) clearInterval(dom_timer);
	if (document.querySelector('#veditor')) {
		var cdraw = new CaveDraw({
			element: "#veditor",
			readOnlyMode: false, // valine 不提交form，而是过滤评论框数据后发送，所以评论框不能readonly。
			afterUpdateEditor: ()=>{ // 手动触发valine对评论框数据的过滤
				document.querySelector('#veditor').focus();
				document.querySelector('#veditor').blur();
			},
			controls: ['brush', 'eraser', 'bucket', 'clear', 'undo', 'redo', 'save']
		});
		clearInterval(dom_timer);
	}
}, 200);
</script>


</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2024 于洋&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery > p > .gallery-item').unwrap();
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="站内搜索" />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>

    
</body>
</html>